#!/bin/bash

# {{ ansible_managed }}

set -o xtrace

# Prepend executable if command starts with an option
if [ "${1:0:1}" = '-' ]; then
    set -- gitlab-runner "$@"
fi

# Allow the container to be stated with `--user`
if [ "$1" = 'gitlab-runner' ] && [ "$(id -u)" = '0' ]; then
    mkdir -p /home/vagrant
    chown vagrant:vagrant /home/vagrant || echo ${?}
    mkdir -p /var/cache/gitlab-runner
    chown vagrant:vagrant /var/cache/gitlab-runner || echo ${?}
fi

exec "$@"
